@model ProductViewModel

@{
    ViewData["Title"] = Model.Name;
}

<div class="container py-4">
    <!-- Breadcrumb Navigation -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a asp-controller="Home" asp-action="Index">Home</a>
            </li>
            <li class="breadcrumb-item">
                <a asp-controller="Product" asp-action="Index">Products</a>
            </li>
            <li class="breadcrumb-item">
                <a asp-controller="Product" asp-action="Index" asp-route-category="@Model.CategoryName">
                    @Model.CategoryName
                </a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">@Model.Name</li>
        </ol>
    </nav>

    <div class="row">
        <!-- Product Image -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <img src="@(string.IsNullOrEmpty(Model.ImageUrl) ? "/images/no-image.png" : Model.ImageUrl)" 
                     class="card-img-top" 
                     alt="@Model.Name"
                     style="width: 100%; height: auto; max-height: 600px; object-fit: contain;">
            </div>
        </div>

        <!-- Product Information -->
        <div class="col-md-6">
            <h1 class="mb-3">@Model.Name</h1>
            
            <!-- Category -->
            <p class="text-muted mb-3">
                <i class="bi bi-tag"></i> 
                <a asp-action="Index" asp-route-category="@Model.CategoryName" class="text-decoration-none">
                    @Model.CategoryName
                </a>
            </p>

            <!-- Pricing -->
            <div class="mb-4">
                <div class="text-primary fw-bold" style="font-size: 2.5rem;">
                    $@Model.Price.ToString("N2")
                </div>
            </div>

            <!-- Stock Availability -->
            <div class="mb-4">
                <h5>Availability:</h5>
                @if (Model.InStock)
                {
                    <span class="badge bg-success fs-6">
                        <i class="bi bi-check-circle"></i> In Stock
                    </span>
                    <p class="text-success mt-2">Available for immediate purchase</p>
                }
                else
                {
                    <span class="badge bg-danger fs-6">
                        <i class="bi bi-x-circle"></i> Out of Stock
                    </span>
                    <p class="text-muted mt-2">This item is currently unavailable</p>
                }
            </div>

            <!-- Product Description -->
            @if (!string.IsNullOrEmpty(Model.Description))
            {
                <div class="mb-4">
                    <h5>Description:</h5>
                    <p class="text-muted">@Model.Description</p>
                </div>
            }

            <!-- Add to Cart Section -->
            @if (Model.InStock)
            {
                <form asp-controller="Cart" asp-action="AddToCart" method="post" class="mb-4">
                    <input type="hidden" name="productId" value="@Model.Id" />
                    
                    <div class="row align-items-end g-3">
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Quantity:</label>
                            <input type="number" 
                                   name="quantity" 
                                   class="form-control form-control-lg" 
                                   value="1" 
                                   min="1" 
                                   max="99"
                                   required />
                        </div>
                        <div class="col-md-8">
                            <button type="submit" class="btn btn-primary btn-lg w-100">
                                <i class="bi bi-cart-plus"></i> Add to Cart
                            </button>
                        </div>
                    </div>
                </form>

                <div class="d-grid gap-2">
                    <button class="btn btn-success btn-lg" onclick="buyNow(@Model.Id)">
                        <i class="bi bi-lightning-fill"></i> Buy Now
                    </button>
                    <button class="btn btn-outline-secondary" onclick="addToWishlist(@Model.Id)">
                        <i class="bi bi-heart"></i> Add to Wishlist
                    </button>
                </div>
            }
            else
            {
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle"></i>
                    This product is currently out of stock. Please check back later.
                </div>
                <button class="btn btn-outline-primary w-100" onclick="notifyWhenAvailable(@Model.Id)">
                    <i class="bi bi-bell"></i> Notify me when available
                </button>
            }

            <!-- Additional Information -->
            <div class="mt-4 p-3 bg-light rounded">
                <h6 class="mb-3"><i class="bi bi-info-circle"></i> Shopping Information</h6>
                <ul class="list-unstyled mb-0 small">
                    <li class="mb-2">
                        <i class="bi bi-truck text-primary"></i> 
                        <strong>Free Shipping:</strong> On orders over $50
                    </li>
                    <li class="mb-2">
                        <i class="bi bi-arrow-clockwise text-primary"></i> 
                        <strong>Easy Returns:</strong> 30-day return policy
                    </li>
                    <li class="mb-2">
                        <i class="bi bi-shield-check text-primary"></i> 
                        <strong>Warranty:</strong> 1-year manufacturer warranty
                    </li>
                    <li class="mb-0">
                        <i class="bi bi-credit-card text-primary"></i> 
                        <strong>Secure Payment:</strong> SSL encrypted checkout
                    </li>
                </ul>
            </div>

            <!-- Share Product -->
            <div class="mt-3">
                <h6>Share this product:</h6>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="shareProduct('facebook')">
                        <i class="bi bi-facebook"></i>
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="shareProduct('twitter')">
                        <i class="bi bi-twitter"></i>
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="shareProduct('pinterest')">
                        <i class="bi bi-pinterest"></i>
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="copyProductLink()">
                        <i class="bi bi-link-45deg"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function buyNow(productId) {
            const quantity = document.querySelector('input[name="quantity"]').value;
            
            // Add to cart first, then redirect to checkout
            fetch('@Url.Action("AddToCart", "Cart")', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `productId=${productId}&quantity=${quantity}`
            })
            .then(response => {
                if (response.ok) {
                    window.location.href = '@Url.Action("Index", "Checkout")';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
            });
        }

        function addToWishlist(productId) {
            fetch('@Url.Action("Add", "Wishlist")', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `productId=${productId}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Product added to wishlist!');
                } else {
                    alert(data.message || 'Failed to add to wishlist');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
            });
        }

        function notifyWhenAvailable(productId) {
            const email = prompt('Enter your email address to get notified when this product is back in stock:');
            if (email) {
                fetch('@Url.Action("NotifyWhenAvailable", "Product")', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `productId=${productId}&email=${encodeURIComponent(email)}`
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Thank you! We will notify you when this product is available.');
                    } else {
                        alert(data.message || 'Failed to register notification');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred. Please try again.');
                });
            }
        }

        function shareProduct(platform) {
            const url = window.location.href;
            const title = '@Model.Name';
            let shareUrl = '';

            switch(platform) {
                case 'facebook':
                    shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
                    break;
                case 'twitter':
                    shareUrl = `https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(title)}`;
                    break;
                case 'pinterest':
                    shareUrl = `https://pinterest.com/pin/create/button/?url=${encodeURIComponent(url)}&description=${encodeURIComponent(title)}`;
                    break;
            }

            if (shareUrl) {
                window.open(shareUrl, '_blank', 'width=600,height=400');
            }
        }

        function copyProductLink() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                alert('Product link copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        }
    </script>
}